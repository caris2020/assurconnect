<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Permissions Dossiers</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .case-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; background: #f9f9f9; }
        .owner-badge { background: #dcfce7; color: #166534; padding: 2px 6px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .action-button { background: #3b82f6; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; margin: 2px; cursor: pointer; }
        .delete-button { background: #ef4444; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; margin: 2px; cursor: pointer; }
        .user-role { background: #e3f2fd; padding: 5px; border-radius: 3px; font-family: monospace; font-weight: bold; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .test-button { background: #3b82f6; color: white; border: none; border-radius: 6px; }
        .simulate-button { background: #10b981; color: white; border: none; border-radius: 6px; }
    </style>
</head>
<body>
    <h1>Test Permissions Dossiers</h1>
    
    <div class="test-section info">
        <h3>Probl√®me Identifi√©</h3>
        <p>Vous √™tes propri√©taire d'un dossier mais vous ne voyez plus les boutons CRUD. Voici les points √† v√©rifier :</p>
        <ul>
            <li>‚úÖ <strong>Permissions charg√©es</strong> : Les permissions sont bien r√©cup√©r√©es depuis le backend</li>
            <li>‚úÖ <strong>Props pass√©es</strong> : Les permissions sont bien pass√©es au composant CaseCard</li>
            <li>‚ö†Ô∏è <strong>Bouton Modifier</strong> : N'appara√Æt que dans la modal des d√©tails, pas sur la carte principale</li>
            <li>‚úÖ <strong>Bouton Supprimer</strong> : Devrait appara√Ætre sur la carte si canDelete = true</li>
        </ul>
    </div>

    <div class="test-section">
        <h3>Test des Permissions Backend</h3>
        <button class="test-button" onclick="testBackendPermissions()">üîê Tester les permissions backend</button>
        <div id="backend-result"></div>
    </div>

    <div class="test-section">
        <h3>Simulation des Cartes de Dossiers</h3>
        <button class="simulate-button" onclick="simulateCaseCards()">üé¥ Simuler les cartes de dossiers</button>
        <div id="cards-result"></div>
    </div>

    <div class="test-section">
        <h3>Instructions de Diagnostic</h3>
        <div id="diagnostic-result"></div>
    </div>

    <script>
        function testBackendPermissions() {
            const resultDiv = document.getElementById('backend-result');
            
            let html = '<div class="warning">';
            html += '<h4>üîê Test des permissions backend</h4>';
            html += '<p><strong>Pour diagnostiquer le probl√®me :</strong></p>';
            html += '<ol>';
            html += '<li><strong>Ouvrez la console du navigateur</strong> (F12)</li>';
            html += '<li><strong>Allez sur la page des dossiers</strong></li>';
            html += '<li><strong>V√©rifiez les logs</strong> pour voir les permissions charg√©es</li>';
            html += '<li><strong>Cherchez les erreurs</strong> dans la console</li>';
            html += '</ol>';
            html += '<p><strong>Logs √† rechercher :</strong></p>';
            html += '<pre>Erreur lors du chargement des permissions pour le dossier X: ...</pre>';
            html += '<pre>Permissions charg√©es: {canEdit: true, canDelete: true}</pre>';
            html += '</div>';
            
            resultDiv.innerHTML = html;
        }

        function simulateCaseCards() {
            const resultDiv = document.getElementById('cards-result');
            
            const currentUser = 'admin';
            const testCases = [
                {
                    id: 1,
                    reference: 'COBRV8LPS0',
                    title: 'usurpation',
                    createdAt: '22/08/2025',
                    createdBy: 'admin',
                    status: 'Sous enqu√™te',
                    canEdit: true,
                    canDelete: true
                },
                {
                    id: 2,
                    reference: 'TEST001',
                    title: 'fraude',
                    createdAt: '21/08/2025',
                    createdBy: 'user1',
                    status: 'Frauduleux',
                    canEdit: false,
                    canDelete: false
                }
            ];
            
            let html = '<div class="success">';
            html += '<h4>üé¥ Simulation des cartes de dossiers</h4>';
            html += '<p>Utilisateur actuel : <span class="user-role">' + currentUser + '</span></p>';
            html += '<p>Voici comment les cartes s\'affichent :</p>';
            
            testCases.forEach(caseItem => {
                const isOwner = caseItem.createdBy === currentUser;
                
                html += '<div class="case-card">';
                html += '<h5 style="margin: 0 0 10px 0;">üîç ' + caseItem.title + '</h5>';
                html += '<p style="margin: 5px 0; font-size: 12px; color: #666;">Cr√©√© le ' + caseItem.createdAt + '</p>';
                
                // Affichage du propri√©taire
                html += '<p style="margin: 5px 0; font-size: 12px; color: #666;">';
                html += 'Par: <span style="font-weight: bold;">' + caseItem.createdBy + '</span>';
                if (isOwner) {
                    html += ' <span class="owner-badge">üë§ Votre dossier</span>';
                }
                html += '</p>';
                
                // Code du dossier
                html += '<p style="margin: 5px 0; font-size: 12px; color: #666;">Code: <span style="font-family: monospace; color: #3b82f6;">' + caseItem.reference + '</span></p>';
                
                // Statut
                html += '<div style="margin: 10px 0;">';
                html += '<span style="background: #dbeafe; color: #1e40af; padding: 2px 6px; border-radius: 12px; font-size: 12px;">' + caseItem.status + '</span>';
                html += '</div>';
                
                // Boutons d'actions
                html += '<div style="margin: 10px 0;">';
                html += '<button class="action-button">Voir le dossier</button>';
                html += '<button class="action-button">üìã Voir rapport</button>';
                html += '</div>';
                
                // Actions conditionnelles
                if (caseItem.canDelete) {
                    html += '<div style="margin: 10px 0;">';
                    html += '<button class="delete-button">üóëÔ∏è Supprimer le dossier</button>';
                    html += '</div>';
                }
                
                // Note sur le bouton Modifier
                html += '<div style="margin: 10px 0; padding: 8px; background: #fef3c7; border-radius: 4px; font-size: 12px;">';
                html += '<strong>Note :</strong> Le bouton "Modifier" n\'appara√Æt que dans la modal des d√©tails (apr√®s avoir cliqu√© sur "Voir le dossier")';
                if (caseItem.canEdit) {
                    html += ' ‚úÖ Vous avez les permissions pour modifier';
                } else {
                    html += ' ‚ùå Vous n\'avez pas les permissions pour modifier';
                }
                html += '</div>';
                
                html += '</div>';
            });
            
            html += '</div>';
            resultDiv.innerHTML = html;
        }

        function showDiagnostic() {
            const resultDiv = document.getElementById('diagnostic-result');
            
            let html = '<div class="info">';
            html += '<h4>üîç Instructions de diagnostic</h4>';
            html += '<p><strong>Pour r√©soudre le probl√®me des boutons CRUD manquants :</strong></p>';
            html += '<ol>';
            html += '<li><strong>V√©rifiez la console</strong> pour les erreurs de permissions</li>';
            html += '<li><strong>Cliquez sur "Voir le dossier"</strong> pour ouvrir la modal</li>';
            html += '<li><strong>Dans la modal</strong>, v√©rifiez s\'il y a un bouton "Modifier le dossier"</li>';
            html += '<li><strong>Sur la carte principale</strong>, v√©rifiez s\'il y a un bouton "Supprimer le dossier"</li>';
            html += '<li><strong>Si les boutons manquent</strong>, c\'est un probl√®me de permissions backend</li>';
            html += '</ol>';
            html += '<p><strong>Solutions possibles :</strong></p>';
            html += '<ul>';
            html += '<li>Red√©marrer le backend pour recharger les permissions</li>';
            html += '<li>V√©rifier que vous √™tes bien connect√© avec le bon utilisateur</li>';
            html += '<li>V√©rifier que le dossier a bien √©t√© cr√©√© par votre utilisateur</li>';
            html += '</ul>';
            html += '</div>';
            
            resultDiv.innerHTML = html;
        }

        // Charger les instructions au chargement de la page
        window.onload = function() {
            showDiagnostic();
        };
    </script>
</body>
</html>
